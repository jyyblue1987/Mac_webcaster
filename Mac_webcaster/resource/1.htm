<style>
    .rotate0 {
        transform-origin:   rotate(0deg);
        -webkit-transform:  rotate(0deg);
        -ms-transform:      rotate(0deg);
        -moz-transform:     rotate(0deg);
        -o-transform:       rotate(0deg);
    }
    .rotate90 {
        transform:          rotate(90deg) scale(1.3);
        -webkit-transform:  rotate(90deg) scale(1.3);
        -ms-transform:      rotate(90deg) scale(1.3);
        -moz-transform:     rotate(90deg) scale(1.3);
        -o-transform:       rotate(90deg) scale(1.3);
    }
    .rotate180 {
        transform:          rotate(180deg);
        -webkit-transform:  rotate(180deg);
        -ms-transform:      rotate(180deg);
        -moz-transform:     rotate(180deg);
        -o-transform:       rotate(180deg);
    }
    .rotate270 {
        transform:          rotate(270deg) scale(1.3);
        -webkit-transform:  rotate(270deg) scale(1.3);
        -ms-transform:      rotate(270deg) scale(1.3);
        -moz-transform:     rotate(270deg) scale(1.3);
        -o-transform:       rotate(270deg) scale(1.3);
    }
</style>
<div id="container" style="width:100%; height:100%">
    <img id="image" src="" style="width:100%; height:100%; object-fit:contain">
</div>

<script>
    var host = window.location.hostname;
    if( host == "" )
        host = "localhost";
    
    console.log(host);

    function WebSocketTest() {
        if ("WebSocket" in window) {
            // Let us open a web socket
            var ws = new WebSocket("ws://" + host + "/websocket");

            ws.onopen = function() {
                console.log("socket is connected")
            };
            
            ws.onmessage = function (event) {
                var data_type = typeof event.data;
                if ( data_type == "string" ) {
                    console.log(event.data);
                    
                    var container = document.getElementById('image');
                    container.className = "rotate" + event.data;
                  
                    return;
                }
                
                var reader = new FileReader();
                reader.readAsDataURL(event.data);
                reader.onloadend = function() {
                    var base64data = reader.result;
                    var res = base64data.replace("data:;base64", "data:image/jpeg;base64");
                    var img = document.getElementById('image');
                    img.src = res;
                    ws.send("ack");
                }
                
            };
            
            ws.onclose = function() {
                
                // websocket is closed.
                console.log("Connection is closed...");
            };
        } else {
            
            // The browser doesn't support WebSocket
            console.log("WebSocket NOT supported by your Browser!");
        }
    }

    setTimeout(function() {
           WebSocketTest();
    }, 500);
    
</script>
