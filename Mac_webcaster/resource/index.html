<style>
    
    #image {
      transform-origin: top left;
      /* IE 10+, Firefox, etc. */
      -webkit-transform-origin: top left;
      /* Chrome */
      -ms-transform-origin: top left;
      /* IE 9 */
    }
    #container.rotate90 #image {
      transform: rotate(90deg) translateY(-100%);
      -webkit-transform: rotate(90deg) translateY(-100%);
      -ms-transform: rotate(90deg) translateY(-100%);
    }
    #container.rotate180 #image {
      transform: rotate(180deg) translate(-100%, -100%);
      -webkit-transform: rotate(180deg) translate(-100%, -100%);
      -ms-transform: rotate(180deg) translateX(-100%, -100%);
    }
    #container.rotate270 #image {
      transform: rotate(270deg) translateX(-100%);
      -webkit-transform: rotate(270deg) translateX(-100%);
      -ms-transform: rotate(270deg) translateX(-100%);
    }
</style>
<div id="container">
    <img id="image" src="">
</div>

<script>
    var host = window.location.hostname;
    if( host == "" )
        host = "localhost";
    
    console.log(host);

    function WebSocketTest() {
        
        if ("WebSocket" in window) {
            // Let us open a web socket
            var ws = new WebSocket("ws://" + host + "/websocket");
            
            ws.onopen = function() {
                console.log("socket is connected")
            };
            
            ws.onmessage = function (event) {
                var data_type = typeof event.data;
                if( data_type == "string" )
                {
                    console.log(event.data);
                    
                    var container = document.getElementById('container');
                    container.className = "rotate" + event.data;
                  
                    return;
                }
                
                var reader = new FileReader();
                reader.readAsDataURL(event.data);
                reader.onloadend = function() {
                    var base64data = reader.result;
                    var res = base64data.replace("data:;base64", "data:image/jpeg;base64");
                    
                    var img = document.getElementById('image');
                    img.src = res;
                    ws.send("ack");
                }
                
            };
            
            ws.onclose = function() {
                
                // websocket is closed.
                console.log("Connection is closed...");
            };
        } else {
            
            // The browser doesn't support WebSocket
            console.log("WebSocket NOT supported by your Browser!");
        }
    }

    setTimeout(function() {
           WebSocketTest();
    }, 500);
    
</script>
